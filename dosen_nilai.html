<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Nilai Pro - Dosen SIAKAD</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- CSS KHUSUS HALAMAN DOSEN PRO --- */
        
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #eeeeee;
            --sidebar-bg: #2c3e50; /* Biru Gelap khas Dosen */
        }

        .dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --sidebar-bg: #1a252f;
        }

        body { background-color: var(--bg-color); color: var(--text-color); transition: 0.3s; }
        .content-card, .header-box .date-box { background-color: var(--card-bg) !important; color: var(--text-color); border: 1px solid var(--border-color); }
        .sidebar { background-color: var(--sidebar-bg); }

        /* Input Nilai Styling */
        .input-nilai {
            width: 60px; padding: 8px; border: 1px solid var(--border-color);
            border-radius: 6px; text-align: center; font-weight: bold;
            background-color: var(--bg-color); color: var(--text-color); transition: 0.2s;
        }
        .input-nilai:focus { border-color: #27ae60; outline: none; background-color: rgba(39, 174, 96, 0.1); transform: scale(1.1); }

        /* Grade Box Styles */
        .grade-box {
            display: inline-flex; align-items: center; justify-content: center;
            width: 35px; height: 35px; border-radius: 50%; font-weight: 800; color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.2s;
        }
        .grade-box:hover { transform: scale(1.2); }
        .grade-A { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .grade-B { background: linear-gradient(135deg, #3498db, #2980b9); }
        .grade-C { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .grade-D { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .grade-E { background: linear-gradient(135deg, #34495e, #2c3e50); }

        /* Stats Cards Dosen */
        .dosen-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px; }
        .stat-card-small {
            background: var(--card-bg); padding: 15px; border-radius: 12px;
            display: flex; align-items: center; justify-content: space-between;
            border-left: 5px solid #2c3e50; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .stat-val { font-size: 20px; font-weight: bold; }
        .stat-label { font-size: 12px; color: #888; }

        /* Progress Bar Presensi */
        .attendance-bar-bg { width: 100%; height: 6px; background: #eee; border-radius: 3px; margin-top: 5px; }
        .attendance-bar-fill { height: 100%; border-radius: 3px; background: #27ae60; }

        /* Actions Toolbar */
        .action-toolbar { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-tool {
            padding: 8px 15px; border: 1px solid var(--border-color); background: var(--card-bg);
            color: var(--text-color); border-radius: 6px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;
        }
        .btn-tool:hover { background: #eee; }
        .btn-save { background: #27ae60; color: white; border: none; }
        .btn-save:hover { background: #219150; }

        /* Dark Mode Toggle */
        .theme-toggle {
            cursor: pointer; padding: 8px; border-radius: 50%; background: var(--border-color);
            width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }

        @media (max-width: 1000px) { .dosen-stats-grid { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">
            <h2>SIAKAD</h2>
            <span>DOSEN PRO</span>
        </div>
        <ul>
            <li><a href="#"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#"><i class="fas fa-calendar-alt"></i> Jadwal Mengajar</a></li>
            <li class="separator">Menu Akademik</li>
            <li><a href="#" class="active"><i class="fas fa-edit"></i> Input Nilai</a></li>
            <li><a href="#"><i class="fas fa-users"></i> Perwalian</a></li>
            <li><a href="#"><i class="fas fa-chart-bar"></i> Statistik</a></li>
            <li class="menu-logout">
                <a href="index.html" onclick="localStorage.clear();">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        
        <div class="header-box">
            <div class="page-title">
                <h1>Input Nilai</h1>
                <p>SI-301 Pemrograman Web Dasar (Kelas A)</p>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <div class="theme-toggle" onclick="toggleDarkMode()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </div>
                <div style="text-align:right;">
                    <h5 style="margin:0; font-size:14px;">Bpk. Abdul Haq, M.Kom</h5>
                    <span style="font-size:11px; color:#888;">NIDN. 0612345678</span>
                </div>
                <div style="width:40px; height:40px; background:#ddd; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-user-tie"></i>
                </div>
            </div>
        </div>

        <div class="dosen-stats-grid">
            <div class="stat-card-small" style="border-left-color: #2980b9;">
                <div>
                    <div class="stat-label">Total Mahasiswa</div>
                    <div class="stat-val">3</div>
                </div>
                <i class="fas fa-users" style="font-size:24px; color:#2980b9; opacity:0.3;"></i>
            </div>
            <div class="stat-card-small" style="border-left-color: #27ae60;">
                <div>
                    <div class="stat-label">Rata-Rata Kelas</div>
                    <div class="stat-val" id="avgClass">0.0</div>
                </div>
                <i class="fas fa-calculator" style="font-size:24px; color:#27ae60; opacity:0.3;"></i>
            </div>
            <div class="stat-card-small" style="border-left-color: #f39c12;">
                <div>
                    <div class="stat-label">Nilai Tertinggi</div>
                    <div class="stat-val" id="maxScore">0</div>
                </div>
                <i class="fas fa-trophy" style="font-size:24px; color:#f39c12; opacity:0.3;"></i>
            </div>
            <div class="stat-card-small" style="border-left-color: #e74c3c;">
                <div>
                    <div class="stat-label">Tingkat Kelulusan</div>
                    <div class="stat-val" id="passRate">0%</div>
                </div>
                <i class="fas fa-chart-pie" style="font-size:24px; color:#e74c3c; opacity:0.3;"></i>
            </div>
        </div>

        <div class="content-card mb-3">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h4 style="margin:0;">Sebaran Nilai (Realtime)</h4>
                <div style="font-size:12px; color:#888;">Update otomatis saat input</div>
            </div>
            <div style="height: 150px; margin-top:10px;">
                <canvas id="gradeChart"></canvas>
            </div>
        </div>

        <div class="content-card">
            
            <div class="action-toolbar">
                <button class="btn-tool"><i class="fas fa-file-excel"></i> Import Excel</button>
                <button class="btn-tool"><i class="fas fa-print"></i> Cetak</button>
                <div style="flex-grow:1;"></div>
                <button class="btn-tool btn-save" onclick="simpanNilai()"><i class="fas fa-save"></i> Simpan & Publish</button>
            </div>

            <div style="overflow-x:auto;">
                <table id="tabelNilai">
                    <thead>
                        <tr>
                            <th width="5%">No</th>
                            <th width="10%">NIM</th>
                            <th width="20%">Mahasiswa</th>
                            <th width="10%">Presensi</th>
                            <th width="8%" class="text-center">Tugas (30%)</th>
                            <th width="8%" class="text-center">UTS (30%)</th>
                            <th width="8%" class="text-center">UAS (40%)</th>
                            <th width="8%" class="text-center">Akhir</th>
                            <th width="8%" class="text-center">Grade</th>
                            <th width="15%">Catatan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>24EP10007</td>
                            <td>
                                <b>Rizqi Ghani A.</b><br>
                                <span style="font-size:11px; color:#888;">Aktif</span>
                            </td>
                            <td>
                                <div style="font-size:11px; display:flex; justify-content:space-between;">
                                    <span>90%</span> <span>14/16</span>
                                </div>
                                <div class="attendance-bar-bg"><div class="attendance-bar-fill" style="width:90%;"></div></div>
                            </td>
                            <td align="center"><input type="number" class="input-nilai" id="tugas_1" value="85" oninput="hitung(1)"></td>
                            <td align="center"><input type="number" class="input-nilai" id="uts_1" value="80" oninput="hitung(1)"></td>
                            <td align="center"><input type="number" class="input-nilai" id="uas_1" value="88" oninput="hitung(1)"></td>
                            <td align="center" style="font-weight:bold;" id="akhir_1">0</td>
                            <td align="center"><div class="grade-box" id="grade_1">-</div></td>
                            <td><input type="text" placeholder="Catatan..." style="width:100%; border:1px solid #ddd; padding:5px; border-radius:4px;"></td>
                        </tr>

                        <tr>
                            <td>2</td>
                            <td>24EP10008</td>
                            <td>
                                <b>Ahmad Faqih</b><br>
                                <span style="font-size:11px; color:#888;">Aktif</span>
                            </td>
                            <td>
                                <div style="font-size:11px; display:flex; justify-content:space-between;">
                                    <span>100%</span> <span>16/16</span>
                                </div>
                                <div class="attendance-bar-bg"><div class="attendance-bar-fill" style="width:100%;"></div></div>
                            </td>
                            <td align="center"><input type="number" class="input-nilai" id="tugas_2" value="95" oninput="hitung(2)"></td>
                            <td align="center"><input type="number" class="input-nilai" id="uts_2" value="90" oninput="hitung(2)"></td>
                            <td align="center"><input type="number" class="input-nilai" id="uas_2" value="92" oninput="hitung(2)"></td>
                            <td align="center" style="font-weight:bold;" id="akhir_2">0</td>
                            <td align="center"><div class="grade-box" id="grade_2">-</div></td>
                            <td><input type="text" placeholder="Catatan..." style="width:100%; border:1px solid #ddd; padding:5px; border-radius:4px;"></td>
                        </tr>

                        <tr>
                            <td>3</td>
                            <td>24EP10009</td>
                            <td>
                                <b>Siti Alia</b><br>
                                <span style="font-size:11px; color:#888;">Cuti</span>
                            </td>
                            <td>
                                <div style="font-size:11px; display:flex; justify-content:space-between;">
                                    <span style="color:red;">40%</span> <span>6/16</span>
                                </div>
                                <div class="attendance-bar-bg"><div class="attendance-bar-fill" style="width:40%; background:red;"></div></div>
                            </td>
                            <td align="center"><input type="number" class="input-nilai" id="tugas_3" value="50" oninput="hitung(3)"></td>
                            <td align="center"><input type="number" class="input-nilai" id="uts_3" value="45" oninput="hitung(3)"></td>
                            <td align="center"><input type="number" class="input-nilai" id="uas_3" value="30" oninput="hitung(3)"></td>
                            <td align="center" style="font-weight:bold;" id="akhir_3">0</td>
                            <td align="center"><div class="grade-box" id="grade_3">-</div></td>
                            <td><input type="text" placeholder="Catatan..." style="width:100%; border:1px solid #ddd; padding:5px; border-radius:4px;"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        // 1. Inisialisasi Chart.js
        const ctx = document.getElementById('gradeChart').getContext('2d');
        const gradeChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['A', 'B', 'C', 'D', 'E'],
                datasets: [{
                    label: 'Jumlah Mahasiswa',
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: [
                        'rgba(46, 204, 113, 0.7)', // A
                        'rgba(52, 152, 219, 0.7)', // B
                        'rgba(241, 196, 15, 0.7)', // C
                        'rgba(231, 76, 60, 0.7)',  // D
                        'rgba(52, 73, 94, 0.7)'    // E
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, ticks: { stepSize: 1 } }
                },
                plugins: { legend: { display: false } }
            }
        });

        // 2. Logic Hitung Nilai & Update Stats
        const totalStudents = 3;

        function hitung(id) {
            // Ambil Input
            let tugas = parseFloat(document.getElementById('tugas_' + id).value) || 0;
            let uts = parseFloat(document.getElementById('uts_' + id).value) || 0;
            let uas = parseFloat(document.getElementById('uas_' + id).value) || 0;

            // Batas Max 100
            if(tugas > 100) document.getElementById('tugas_' + id).value = 100;
            if(uts > 100) document.getElementById('uts_' + id).value = 100;
            if(uas > 100) document.getElementById('uas_' + id).value = 100;

            // Hitung
            let nilaiAkhir = (tugas * 0.30) + (uts * 0.30) + (uas * 0.40);
            document.getElementById('akhir_' + id).innerText = nilaiAkhir.toFixed(1);

            // Grade
            let grade = 'E';
            let gradeClass = 'grade-E';
            if (nilaiAkhir >= 85) { grade = 'A'; gradeClass = 'grade-A'; }
            else if (nilaiAkhir >= 75) { grade = 'B'; gradeClass = 'grade-B'; }
            else if (nilaiAkhir >= 60) { grade = 'C'; gradeClass = 'grade-C'; }
            else if (nilaiAkhir >= 50) { grade = 'D'; gradeClass = 'grade-D'; }

            let el = document.getElementById('grade_' + id);
            el.innerText = grade;
            el.className = 'grade-box ' + gradeClass;
            el.setAttribute('data-grade', grade); // Simpan data grade untuk chart
            el.setAttribute('data-score', nilaiAkhir); // Simpan score untuk stats

            updateAllStats();
        }

        // 3. Update Chart & Summary Cards
        function updateAllStats() {
            let counts = { A: 0, B: 0, C: 0, D: 0, E: 0 };
            let totalScore = 0;
            let maxScore = 0;
            let passed = 0;

            for (let i = 1; i <= totalStudents; i++) {
                let el = document.getElementById('grade_' + i);
                let g = el.getAttribute('data-grade') || 'E';
                let s = parseFloat(el.getAttribute('data-score')) || 0;

                counts[g]++;
                totalScore += s;
                if(s > maxScore) maxScore = s;
                if(g !== 'E' && g !== 'D') passed++; // Anggap D tidak lulus
            }

            // Update Chart
            gradeChart.data.datasets[0].data = [counts.A, counts.B, counts.C, counts.D, counts.E];
            gradeChart.update();

            // Update Cards
            document.getElementById('avgClass').innerText = (totalScore / totalStudents).toFixed(1);
            document.getElementById('maxScore').innerText = maxScore.toFixed(1);
            let rate = (passed / totalStudents) * 100;
            document.getElementById('passRate').innerText = rate.toFixed(0) + '%';
        }

        // 4. Dark Mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('themeIcon');
            if(document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon'); icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun'); icon.classList.add('fa-moon');
            }
        }

        function simpanNilai() {
            alert("Nilai berhasil disimpan dan dipublish ke mahasiswa!");
        }

        // Jalankan saat load
        window.onload = function() {
            for(let i=1; i<=3; i++) hitung(i);
        };
    </script>
</body>
</html>
