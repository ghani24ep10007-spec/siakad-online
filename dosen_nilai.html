<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIAKAD Dosen - Input Nilai</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- 1. CSS VARIABLES (Tema Warna) --- */
        :root {
            --primary: #2c3e50; /* Biru Tua Dosen */
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --bg-body: #f4f6f9;
            --bg-card: #ffffff;
            --text-main: #333;
            --border: #e0e0e0;
        }

        .dark-mode {
            --primary: #1a252f;
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --border: #333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); display: flex; min-height: 100vh; transition: 0.3s; }

        /* --- 2. SIDEBAR --- */
        .sidebar { width: 260px; background: var(--primary); color: white; position: fixed; height: 100%; z-index: 10; display: flex; flex-direction: column; }
        .logo { padding: 25px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo h2 { letter-spacing: 1px; margin-bottom: 5px; }
        
        .nav-links { list-style: none; padding: 20px 0; flex: 1; }
        .nav-links li a { display: flex; align-items: center; padding: 12px 25px; color: rgba(255,255,255,0.7); text-decoration: none; transition: 0.2s; font-size: 14px; border-left: 4px solid transparent; cursor: pointer;}
        .nav-links li a:hover, .nav-links li a.active { background: rgba(255,255,255,0.1); color: white; border-left-color: var(--accent); }
        .nav-links li a i { width: 25px; margin-right: 10px; }

        /* --- 3. KONTEN UTAMA --- */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; }

        /* Header */
        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-info { text-align: right; display: flex; align-items: center; gap: 15px; }
        .avatar { width: 45px; height: 45px; background: #e0e0e0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: var(--primary); }

        /* Cards & Layout */
        .grid-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .card { background: var(--bg-card); border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        
        .stat-item { display: flex; align-items: center; justify-content: space-between; border-left: 4px solid var(--accent); padding-left: 15px; }
        .stat-item h3 { font-size: 24px; margin: 0; }
        .stat-item p { font-size: 12px; color: #888; margin: 0; }

        /* Tabel Input Nilai */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 15px; background: rgba(0,0,0,0.02); border-bottom: 2px solid var(--border); font-size: 13px; color: #666; }
        td { padding: 12px 15px; border-bottom: 1px solid var(--border); font-size: 13px; vertical-align: middle; }
        
        /* Input Styling */
        .input-score { width: 60px; text-align: center; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-weight: bold; transition: 0.2s; }
        .input-score:focus { border-color: var(--success); outline: none; background: rgba(39, 174, 96, 0.1); transform: scale(1.1); }

        /* Grade Badge */
        .grade-badge { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; color: white; font-size: 12px; margin: 0 auto; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .bg-A { background: var(--success); } 
        .bg-B { background: var(--accent); } 
        .bg-C { background: var(--warning); }
        .bg-D { background: var(--danger); }
        .bg-E { background: #34495e; }

        /* Tombol */
        .btn { padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 13px; border: none; display: inline-flex; align-items: center; gap: 5px; transition: 0.2s; }
        .btn-save { background: var(--success); color: white; }
        .btn-save:hover { background: #219150; transform: translateY(-2px); }
        .btn-print { background: white; border: 1px solid var(--border); color: var(--text-main); }
        .btn-print:hover { background: #eee; }

        /* Theme Toggle */
        .theme-btn { cursor: pointer; padding: 10px; background: var(--bg-body); border-radius: 50%; border: 1px solid var(--border); }

        @media (max-width: 900px) {
            .sidebar { width: 70px; overflow: hidden; }
            .logo h2, .logo span, .nav-links a span { display: none; }
            .nav-links a { justify-content: center; }
            .main-content { margin-left: 70px; width: calc(100% - 70px); }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">
            <h2>SIAKAD</h2>
            <span>DOSEN PRO</span>
        </div>
        <ul class="nav-links">
            <li><a href="#"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
            <li><a href="#"><i class="fas fa-calendar-alt"></i> <span>Jadwal Ajar</span></a></li>
            <li><a href="#" class="active"><i class="fas fa-edit"></i> <span>Input Nilai</span></a></li>
            <li><a href="#"><i class="fas fa-users"></i> <span>Perwalian</span></a></li>
            <li style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1);">
                <a href="index.html" onclick="localStorage.clear();" style="color: #ff6b6b;">
                    <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        
        <div class="header-box">
            <div>
                <h1 style="font-size: 24px; font-weight: 700;">Input Nilai Mahasiswa</h1>
                <p style="color: #777; font-size: 13px;">SI-301 Pemrograman Web Dasar (Kelas A)</p>
            </div>
            <div class="user-info">
                <button class="theme-btn" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
                <div style="text-align: right;">
                    <h5 style="margin:0; font-size:14px;">Ibu Ihda, M.Kom</h5>
                    <span style="font-size:11px; color:#777;">NIDN. 202601001</span>
                </div>
                <div class="avatar"><i class="fas fa-user-tie"></i></div>
            </div>
        </div>

        <div class="grid-stats">
            <div class="card stat-item" style="border-color: var(--accent);">
                <div><h3>10</h3><p>Total Mahasiswa</p></div>
                <i class="fas fa-users" style="font-size:30px; color:var(--accent); opacity:0.3;"></i>
            </div>
            <div class="card stat-item" style="border-color: var(--success);">
                <div><h3 id="avgScore">0.0</h3><p>Rata-Rata Kelas</p></div>
                <i class="fas fa-calculator" style="font-size:30px; color:var(--success); opacity:0.3;"></i>
            </div>
            <div class="card stat-item" style="border-color: var(--warning);">
                <div><h3 id="maxScore">0</h3><p>Nilai Tertinggi</p></div>
                <i class="fas fa-trophy" style="font-size:30px; color:var(--warning); opacity:0.3;"></i>
            </div>
            <div class="card stat-item" style="border-color: var(--danger);">
                <div><h3 id="passRate">100%</h3><p>Kelulusan</p></div>
                <i class="fas fa-chart-pie" style="font-size:30px; color:var(--danger); opacity:0.3;"></i>
            </div>
        </div>

        <div class="grid-stats" style="grid-template-columns: 2fr 1fr;">
            <div class="card">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <h4>Distribusi Nilai</h4>
                    <span style="font-size:11px; background:#e8f5e9; padding:2px 8px; border-radius:10px; color:green;">Live Update</span>
                </div>
                <div style="height: 150px;"><canvas id="gradeChart"></canvas></div>
            </div>
            <div class="card">
                <h4>Filter Kelas</h4>
                <select style="width:100%; padding:10px; margin-top:10px; border:1px solid var(--border); border-radius:6px; background:var(--bg-body); color:var(--text-main);">
                    <option>SI-301 Pemrograman Web (A)</option>
                    <option>SI-305 Basis Data (B)</option>
                </select>
                <button class="btn btn-save" style="width:100%; margin-top:15px; justify-content:center;">
                    <i class="fas fa-sync"></i> Muat Data
                </button>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h4 style="margin:0;">Daftar Nilai (Teman Sekelas)</h4>
                <div>
                    <button class="btn btn-print"><i class="fas fa-file-excel" style="color:green;"></i> Excel</button>
                    <button class="btn btn-save" onclick="alert('Data berhasil disimpan ke Server!')"><i class="fas fa-save"></i> Simpan & Publish</button>
                </div>
            </div>

            <div class="table-container">
                <table id="nilaiTable">
                    <thead>
                        <tr>
                            <th width="5%">No</th>
                            <th width="12%">NIM</th>
                            <th width="20%">Nama Mahasiswa</th>
                            <th width="8%" class="text-center">Tugas (30%)</th>
                            <th width="8%" class="text-center">UTS (30%)</th>
                            <th width="8%" class="text-center">UAS (40%)</th>
                            <th width="8%" class="text-center">Akhir</th>
                            <th width="8%" class="text-center">Grade</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        // 1. DATA TEMAN-TEMAN (Default Nilai Bagus, Tidak Ada E)
        const students = [
            { nim: "24EP10001", name: "Ahmad Faqih", t: 90, ut: 85, ua: 88 },
            { nim: "24EP10002", name: "M. Toik", t: 85, ut: 80, ua: 82 },
            { nim: "24EP10003", name: "Widad", t: 88, ut: 90, ua: 85 },
            { nim: "24EP10004", name: "Dinda", t: 92, ut: 92, ua: 95 },
            { nim: "24EP10005", name: "Siti Alia", t: 80, ut: 75, ua: 78 },
            { nim: "24EP10006", name: "Nwalia", t: 85, ut: 85, ua: 85 },
            { nim: "24EP10007", name: "Syafa", t: 82, ut: 80, ua: 84 },
            { nim: "24EP10008", name: "Rizqi", t: 78, ut: 75, ua: 80 },
            { nim: "24EP10009", name: "Ghani", t: 88, ut: 85, ua: 90 },
            { nim: "24EP10010", name: "Fiki", t: 75, ut: 70, ua: 75 },
        ];

        // 2. GENERATE TABEL OTOMATIS
        const tbody = document.getElementById('tableBody');
        
        function renderTable() {
            tbody.innerHTML = ''; // Reset isi tabel
            students.forEach((mhs, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${mhs.nim}</td>
                    <td><b>${mhs.name}</b><br><span style="font-size:10px; color:green;">‚óè Aktif</span></td>
                    <td align="center"><input type="number" class="input-score" id="t_${index}" value="${mhs.t}" oninput="calculate(${index})"></td>
                    <td align="center"><input type="number" class="input-score" id="ut_${index}" value="${mhs.ut}" oninput="calculate(${index})"></td>
                    <td align="center"><input type="number" class="input-score" id="ua_${index}" value="${mhs.ua}" oninput="calculate(${index})"></td>
                    <td align="center"><b id="akhir_${index}">0</b></td>
                    <td align="center"><div class="grade-badge" id="grade_${index}">-</div></td>
                    <td><input type="text" value="Pertahankan!" style="width:100%; border:1px solid #ddd; padding:5px; border-radius:4px; font-size:12px; color:#555;"></td>
                `;
                tbody.appendChild(tr);
                calculate(index); // Hitung langsung saat load
            });
        }

        // 3. LOGIC HITUNG NILAI
        function calculate(idx) {
            let t = parseFloat(document.getElementById(`t_${idx}`).value) || 0;
            let ut = parseFloat(document.getElementById(`ut_${idx}`).value) || 0;
            let ua = parseFloat(document.getElementById(`ua_${idx}`).value) || 0;

            // Batas Nilai 100
            if(t>100) document.getElementById(`t_${idx}`).value = 100;
            if(ut>100) document.getElementById(`ut_${idx}`).value = 100;
            if(ua>100) document.getElementById(`ua_${idx}`).value = 100;

            let final = (t * 0.3) + (ut * 0.3) + (ua * 0.4);
            document.getElementById(`akhir_${idx}`).innerText = final.toFixed(1);

            let grade = 'E';
            if (final >= 85) grade = 'A';
            else if (final >= 75) grade = 'B';
            else if (final >= 60) grade = 'C';
            else if (final >= 50) grade = 'D';

            let badge = document.getElementById(`grade_${idx}`);
            badge.innerText = grade;
            badge.className = `grade-badge bg-${grade}`;
            badge.setAttribute('data-grade', grade); // Simpan untuk chart

            updateStats(); // Update Grafik & Kartu Statistik
        }

        // 4. CHART & STATISTIK
        let myChart;
        function initChart() {
            const ctx = document.getElementById('gradeChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['A', 'B', 'C', 'D', 'E'],
                    datasets: [{
                        label: 'Jumlah Mahasiswa',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: ['#27ae60', '#3498db', '#f1c40f', '#e74c3c', '#34495e'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });
        }

        function updateStats() {
            let counts = { A: 0, B: 0, C: 0, D: 0, E: 0 };
            let totalScore = 0;
            let maxVal = 0;

            for(let i=0; i<students.length; i++) {
                let g = document.getElementById(`grade_${i}`).getAttribute('data-grade') || 'E';
                let s = parseFloat(document.getElementById(`akhir_${i}`).innerText) || 0;
                
                counts[g]++;
                totalScore += s;
                if(s > maxVal) maxVal = s;
            }

            // Update Chart
            myChart.data.datasets[0].data = [counts.A, counts.B, counts.C, counts.D, counts.E];
            myChart.update();

            // Update Cards
            document.getElementById('avgScore').innerText = (totalScore / students.length).toFixed(1);
            document.getElementById('maxScore').innerText = maxVal.toFixed(1);
        }

        // 5. DARK MODE
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        // START APP
        window.onload = function() {
            renderTable();
            initChart();
            setTimeout(updateStats, 500); // Pastikan DOM siap
        };
    </script>
</body>
</html>
